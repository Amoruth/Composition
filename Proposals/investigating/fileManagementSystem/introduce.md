# 基于密码学的安全文件存储系统

   - **目标**：设计一个基于密码学的安全文件存储系统，确保文件机密性和完整性。
   - **内容**：
     - 实现文件加密、解密和完整性验证功能。
     - 设计用户权限管理和访问控制机制。
     - 提供用户友好的文件管理界面。
   - **创新点**：结合多种密码学技术，提升系统安全性。



## [SFS 的设计与实现](./Design and implementation of secure file system.pdf)

### 目标：

1. **数据安全性**：通过使用强加密技术（特别是 AES）和访问控制机制，确保文件的机密性和完整性。
2. **透明性**：加密和解密过程对用户透明，意味着在文件访问或存储时无需用户干预。
3. **用户便利性**：该系统设计简便易用，用户配置要求最小。

### 架构：

安全文件系统（SFS）在内核中运行，并与虚拟文件系统（VFS）层紧密交互。其核心功能基于：

1. **透明加密**：存储在以“ecrypt”前缀命名的目录中的文件在写入时会自动加密，在读取时自动解密，无需明确的用户输入。
2. **访问控制**：SFS集成了一个强大的访问控制机制，基于公钥加密技术控制文件的访问。每个文件都使用唯一的对称密钥进行加密，并通过访问控制列表（ACL）对文件的访问进行管理，确保只有授权用户能够访问。

### 关键组件：

- **VFS 层**：处理所有与文件相关的系统调用，如果文件被保存到以“ecrypt”前缀命名的目录中，控制将转交给 SFS 进行加密。
- **加密引擎**：使用 AES 进行文件数据的实际加密和解密。它根据需要进行数据填充，以满足加密块大小要求，并管理相关的加密密钥。
- **访问控制器**：准备 ACL，并使用授权用户的公钥对文件的对称密钥进行加密。它还确保 ACL 的完整性。
- **文件头**：每个文件都会附加一个头部，包含加密密钥的哈希值（HKEY）和其他控制元素，这些都是安全访问所必需的元数据。

### 文件处理：

1. **加密**：在保存文件之前，文件数据会使用为每个文件生成的唯一对称密钥进行加密。然后，该密钥会使用每个授权用户的公钥进行加密，并存储在文件的头部。
2. **解密**：当访问文件时，系统读取头部，提取适当的密钥，并使用它解密文件数据。只有当用户的私钥与 ACL 中加密的密钥匹配时，才能授予访问权限。

### 性能和可用性：

该系统在内核空间实现，以提高效率，并与现有的文件系统（如 ext2、ext3 等）无缝集成，确保加密文件被应用程序像常规文件一样处理。加密过程是在文件存储和访问时透明地进行的，无需用户干预，因此保持了系统性能。

然而，处理较大文件时，加密会带来一些性能开销。系统还需要额外的存储空间来存储元数据（文件头和加密密钥）。

### 安全特性：

- **强大的密钥管理**：用户的私钥不会存储在磁盘上，而是通过智能卡或其他方式安全管理，以防止密钥泄露。
- **端到端保护**：该系统确保文件从创建到被授权用户访问期间都始终加密并受到访问控制。

### 结论：

SFS 通过将透明文件加密集成到内核中，增强了 Linux 的安全性。它旨在确保安全性、效率和用户友好性，提供通过加密方法的强大访问控制。该系统避免将加密密钥存储在磁盘上，减少了未经授权访问的风险。



## 改进

#### 1. **智能加密策略（基于数据分类的加密）**

- **创新点**：在传统的基于目录的加密机制基础上，进一步引入智能加密策略，根据文件的内容和类型自动决定加密强度和加密方式。例如，系统可以识别文件内容的敏感度（如财务数据、个人信息、源代码等），然后使用不同的加密算法（如 AES、RSA、或混合加密）和密钥长度进行加密。
- **实现方式**：结合数据分类算法（如文本分类或基于规则的分类），通过对文件内容的分析来动态选择加密策略。比如，对于财务数据使用更强的加密算法（如 AES 256），而对于普通文档则使用 AES 128。

#### 2. **加密密钥的多重安全存储（去中心化存储）**

- **创新点**：目前的密钥存储方式多依赖于智能卡或外部硬件模块（如 HSM）。可以进一步创新，在去中心化存储环境中（例如基于区块链的密钥管理），提升密钥的安全性和可追溯性。这样可以避免传统密钥管理系统中的单点故障和安全漏洞。
- **实现方式**：将加密密钥通过区块链技术分散存储，利用智能合约来控制密钥的访问权限。当文件需要被访问时，系统通过区块链进行密钥查询和验证。这种去中心化方式确保了密钥的安全存储，同时还具备高可用性和不可篡改性。

#### 3. **智能访问控制与行为分析（动态权限控制）**

- **创新点**：现有的访问控制方法通常基于静态规则（如 ACL）。可以加入基于行为分析的动态权限控制机制，根据用户的行为模式和访问习惯动态调整文件访问权限。例如，系统可以根据用户的历史访问记录、位置、设备和访问时间等信息来判断是否允许访问。
- **实现方式**：集成机器学习算法进行用户行为分析，实时监控用户的操作模式。当检测到异常行为时（例如，用户从不常用的设备或地点访问敏感文件），可以触发额外的安全验证机制，如多因素认证（MFA）或临时权限变更。

#### 4. **多层次数据防泄漏技术（防泄漏与隐写术结合）**

- **创新点**：除了加密之外，可以结合隐写术（steganography）技术，进一步提高数据泄露防护能力。隐写术可以将加密后的文件数据隐藏在无关文件或非敏感文件中，甚至隐藏在图片、音频等多媒体数据中，以增加数据的隐蔽性。
- **实现方式**：在文件加密后，利用隐写术技术将加密后的数据隐藏在图像或音频文件的无关部分。当文件需要访问时，系统会先提取出隐藏的数据，再进行解密。这样，即使文件被盗取，攻击者也难以通过常规手段发现文件的存在。

#### 5. **集成云存储加密（边缘计算与分布式存储）**

- **创新点**：随着云计算和边缘计算的普及，文件存储不再局限于本地文件系统。可以设计一个分布式安全文件系统，使得文件在传输和存储过程中始终保持加密状态，并且集成云存储服务。加密系统不仅仅局限于本地磁盘，还能在云端和边缘设备之间自动进行加密和解密。
- **实现方式**：设计一个具有端到端加密（E2EE）功能的云文件系统，通过边缘计算节点和云服务器之间的加密传输，确保文件始终处于加密状态。在文件上传到云存储之前，文件会在本地加密，只有授权用户才能解密并访问。为了提高系统的效率，可以利用云边协同加速解密过程。

#### 6. **集成硬件加速（加速加解密过程）**

- **创新点**：为了提升文件加密和解密的性能，可以设计一种硬件加速的加解密机制。通过使用专门的加密硬件（如 FPGA、ASIC、GPU）加速加密算法，减少系统开销，提高系统在处理大量文件时的效率。
- **实现方式**：设计一个硬件加速的加密引擎，可以与 Linux 内核协同工作，直接调用硬件加速模块执行 AES、RSA 等加密算法。该引擎可通过内核模块与文件系统集成，提供对文件加密的高效支持。

#### 7. **基于行为的自动加密策略（自动数据保护）**

- **创新点**：可以根据文件的使用行为（如文件被编辑、共享、上传等）自动调整加密级别。系统可以自动识别哪些文件正在被频繁使用或涉及敏感数据，并在这些情况下自动加密或提升加密级别。
- **实现方式**：通过监控文件的生命周期和访问模式，结合机器学习算法分析文件是否涉及敏感信息，并自动决定是否需要提升加密强度。例如，用户修改财务报告或含有个人信息的文件时，系统自动提升加密级别，增加文件的保护级别。

